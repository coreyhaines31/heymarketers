<!-- Marketing Specialists Directory -->
<div class="min-h-screen" style="background-color: var(--color-background);">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-2xl font-bold" style="color: var(--color-foreground);">Find Your Perfect Marketing Expert</h1>
          <p class="mt-1" style="color: var(--color-muted-foreground);">
            <% if @search_params[:query].present? %>
              Found <%= @total_count %> marketing professionals for "<%= @search_params[:query] %>"
            <% else %>
              Browse our directory of <%= @total_count %> marketing professionals
            <% end %>
          </p>
        </div>
        <div class="flex items-center space-x-3">
          <button id="toggle-advanced-filters" class="btn btn-outline">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z" />
            </svg>
            <span class="filter-text">Advanced Filters</span>
          </button>
          <% if user_signed_in? && !current_user.marketer? %>
            <%= link_to new_marketer_profile_path, class: "btn btn-primary" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Join Directory
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Search & Filters -->
    <div class="card mb-8">
      <div class="card-body">
        <%= form_with url: marketers_path, method: :get, local: true, class: "space-y-6", id: "search-form" do |f| %>

          <!-- Main Search Bar -->
          <div class="flex gap-4">
            <div class="flex-1">
              <%= f.text_field :query,
                  placeholder: "Search by name, skills, or expertise...",
                  value: @search_params[:query],
                  class: "input w-full text-lg",
                  autocomplete: "off" %>
            </div>
            <div class="flex items-center space-x-2">
              <%= f.select :sort,
                  options_for_select(@sort_options.map { |s| [s.humanize, s] }, @search_params[:sort]),
                  { prompt: "Sort by..." },
                  { class: "input" } %>
              <%= f.submit "Search", class: "btn btn-primary px-6" %>
            </div>
          </div>

          <!-- Quick Filters -->
          <div class="flex flex-wrap gap-3">
            <% if @search_params.any? { |k, v| v.present? && k != 'query' && k != 'sort' } %>
              <%= link_to "Clear Filters", marketers_path, class: "btn btn-outline btn-sm" %>
            <% end %>

            <!-- Active Filter Tags -->
            <% if @search_params[:location_id].present? %>
              <% location = @locations.find { |l| l.id.to_s == @search_params[:location_id].to_s } %>
              <% if location %>
                <span class="inline-flex items-center px-3 py-1 text-sm rounded-full" style="background-color: var(--color-accent); color: var(--color-accent-foreground);">
                  üìç <%= location.name %>
                  <%= link_to marketers_path(@search_params.except(:location_id)), class: "ml-2 hover:text-red-600" do %>
                    √ó
                  <% end %>
                </span>
              <% end %>
            <% end %>

            <% if @search_params[:experience_level].present? %>
              <span class="inline-flex items-center px-3 py-1 text-sm rounded-full" style="background-color: var(--color-accent); color: var(--color-accent-foreground);">
                üéØ <%= @search_params[:experience_level].humanize %>
                <%= link_to marketers_path(@search_params.except(:experience_level)), class: "ml-2 hover:text-red-600" do %>
                  √ó
                <% end %>
              </span>
            <% end %>

            <% if @search_params[:min_rate].present? || @search_params[:max_rate].present? %>
              <span class="inline-flex items-center px-3 py-1 text-sm rounded-full" style="background-color: var(--color-accent); color: var(--color-accent-foreground);">
                üí∞ $<%= @search_params[:min_rate] || '0' %> - $<%= @search_params[:max_rate] || '‚àû' %>/hr
                <%= link_to marketers_path(@search_params.except(:min_rate, :max_rate)), class: "ml-2 hover:text-red-600" do %>
                  √ó
                <% end %>
              </span>
            <% end %>
          </div>

          <!-- Advanced Filters Panel -->
          <div id="advanced-filters" class="border-t pt-6" style="border-color: var(--color-border); display: none;">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

              <!-- Skills Filter -->
              <div>
                <label class="block text-sm font-medium mb-2" style="color: var(--color-foreground);">Skills</label>
                <%= f.select :skill_ids,
                    options_from_collection_for_select(@skills, :id, :name, @search_params[:skill_ids]),
                    { prompt: "All Skills" },
                    { class: "input w-full", multiple: true } %>
              </div>

              <!-- Location Filter -->
              <div>
                <label class="block text-sm font-medium mb-2" style="color: var(--color-foreground);">Location</label>
                <%= f.select :location_id,
                    options_from_collection_for_select(@locations, :id, :name, @search_params[:location_id]),
                    { prompt: "All Locations" },
                    { class: "input w-full" } %>
              </div>

              <!-- Experience Level -->
              <div>
                <label class="block text-sm font-medium mb-2" style="color: var(--color-foreground);">Experience Level</label>
                <%= f.select :experience_level,
                    options_for_select(@experience_levels.map { |level| [level.humanize, level] }, @search_params[:experience_level]),
                    { prompt: "Any Level" },
                    { class: "input w-full" } %>
              </div>

              <!-- Availability -->
              <div>
                <label class="block text-sm font-medium mb-2" style="color: var(--color-foreground);">Availability</label>
                <%= f.select :availability,
                    options_for_select(@availability_options, @search_params[:availability]),
                    { prompt: "Any Availability" },
                    { class: "input w-full" } %>
              </div>

              <!-- Rate Range -->
              <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-2" style="color: var(--color-foreground);">Hourly Rate</label>
                <div class="flex space-x-2">
                  <%= f.number_field :min_rate,
                      placeholder: "Min ($)",
                      value: @search_params[:min_rate],
                      class: "input w-full" %>
                  <%= f.number_field :max_rate,
                      placeholder: "Max ($)",
                      value: @search_params[:max_rate],
                      class: "input w-full" %>
                </div>
              </div>

              <!-- Filter Actions -->
              <div class="flex items-end space-x-2">
                <%= f.submit "Apply Filters", class: "btn btn-primary" %>
                <%= link_to "Reset", marketers_path, class: "btn btn-outline" %>
              </div>
            </div>
          </div>

        <% end %>
      </div>
    </div>

    <!-- Results -->
    <% if @marketer_profiles.any? %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% @marketer_profiles.each do |profile| %>
          <div class="card">
            <div class="card-body">
              <div class="flex items-start space-x-4">
                <div class="w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold" style="background-color: var(--color-primary);">
                  <%= profile.account.name.first(2).upcase %>
                </div>
                <div class="flex-1">
                  <div class="flex items-start justify-between">
                    <div>
                      <h3 class="font-semibold" style="color: var(--color-foreground);"><%= profile.account.name %></h3>
                      <p class="text-sm" style="color: var(--color-muted-foreground);"><%= profile.title %></p>
                      <% if profile.location %>
                        <p class="text-xs mt-1" style="color: var(--color-muted-foreground);">üìç <%= profile.location.name %></p>
                      <% end %>
                    </div>
                    <div class="text-right">
                      <p class="font-semibold" style="color: var(--color-foreground);"><%= profile.display_rate %></p>
                      <div class="flex items-center mt-1">
                        <div class="flex text-yellow-400">
                          <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                          <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                        </div>
                        <span class="text-xs ml-1" style="color: var(--color-muted-foreground);">5.0 (12)</span>
                      </div>
                    </div>
                  </div>
                  <p class="text-sm mt-3" style="color: var(--color-muted-foreground);">
                    <%= truncate(profile.bio, length: 120) %>
                  </p>
                  <div class="flex items-center justify-between mt-4">
                    <div class="flex space-x-2">
                      <% if profile.skills.any? %>
                        <% profile.skills.limit(1).each do |skill| %>
                          <span class="badge badge-primary"><%= skill.name %></span>
                        <% end %>
                        <% profile.skills.offset(1).limit(2).each do |skill| %>
                          <span class="badge badge-outline"><%= skill.name %></span>
                        <% end %>
                        <% if profile.skills.count > 3 %>
                          <span class="badge badge-outline">+<%= profile.skills.count - 3 %> more</span>
                        <% end %>
                      <% end %>
                    </div>
                    <%= link_to "Contact", marketer_path(profile), class: "btn btn-primary btn-sm" %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Pagination -->
      <div class="mt-8 flex justify-center">
        <%= paginate @marketer_profiles, params: @search_params %>
      </div>
    <% else %>
      <!-- Empty State -->
      <div class="text-center py-12">
        <div class="w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-4" style="background-color: var(--color-accent);">
          <svg class="w-8 h-8" style="color: var(--color-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        <h3 class="text-lg font-medium mb-2" style="color: var(--color-foreground);">No marketers found</h3>
        <p class="text-sm mb-6" style="color: var(--color-muted-foreground);">Try adjusting your filters or browse all marketers</p>
        <%= link_to "Clear Filters", marketers_path, class: "btn btn-outline" %>
      </div>
    <% end %>

    <!-- Call to Action -->
    <% if user_signed_in? && !current_user.marketer? %>
      <div class="mt-12 text-center">
        <div class="card">
          <div class="card-body">
            <h3 class="text-lg font-semibold mb-2" style="color: var(--color-foreground);">Are you a marketing professional?</h3>
            <p class="text-sm mb-4" style="color: var(--color-muted-foreground);">Join our directory and connect with businesses looking for your expertise</p>
            <%= link_to "Create Your Profile", new_marketer_profile_path, class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- JavaScript for Advanced Search Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Advanced Filters Toggle
  const toggleButton = document.getElementById('toggle-advanced-filters');
  const advancedFilters = document.getElementById('advanced-filters');
  const filterText = toggleButton.querySelector('.filter-text');

  if (toggleButton && advancedFilters) {
    toggleButton.addEventListener('click', function() {
      const isVisible = advancedFilters.style.display !== 'none';

      if (isVisible) {
        advancedFilters.style.display = 'none';
        filterText.textContent = 'Advanced Filters';
      } else {
        advancedFilters.style.display = 'block';
        filterText.textContent = 'Hide Filters';
      }
    });

    // Show advanced filters if any advanced filters are active
    const hasAdvancedFilters = <%= (@search_params[:skill_ids].present? ||
                                   @search_params[:experience_level].present? ||
                                   @search_params[:availability].present? ||
                                   @search_params[:min_rate].present? ||
                                   @search_params[:max_rate].present?).to_json %>;

    if (hasAdvancedFilters) {
      advancedFilters.style.display = 'block';
      filterText.textContent = 'Hide Filters';
    }
  }

  // Auto-submit form on sort change
  const sortSelect = document.querySelector('select[name="sort"]');
  if (sortSelect) {
    sortSelect.addEventListener('change', function() {
      this.form.submit();
    });
  }

  // Real-time search with debouncing
  const searchInput = document.querySelector('input[name="query"]');
  if (searchInput) {
    let searchTimeout;

    searchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);

      searchTimeout = setTimeout(() => {
        // Only auto-submit if user has typed at least 3 characters or cleared the field
        if (this.value.length >= 3 || this.value.length === 0) {
          this.form.submit();
        }
      }, 500); // 500ms delay
    });
  }
});
</script>